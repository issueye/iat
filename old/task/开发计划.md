# iat 开发计划文档

## 1. 阶段规划概览

本项目开发分为 **6 个主要阶段**，从基础设施搭建到功能完善，最后进行测试与发布。

| 阶段 | 名称 | 重点目标 | 预计周期 |
| :--- | :--- | :--- | :--- |
| **Phase 1** | **基建与环境** | Wails 初始化、DB 设计、基础库封装 | TBD |
| **Phase 2** | **核心引擎** | Goja 集成、Eino 集成、SSE 通信 | TBD |
| **Phase 3** | **基础业务** | 项目管理、会话管理、前端框架搭建 | TBD |
| **Phase 4** | **进阶业务** | 脚本系统、工具系统、MCP、Agent 编排 | TBD |
| **Phase 5** | **UI/UX 完善** | 界面美化、交互优化、Markdown 渲染 | TBD |
| **Phase 6** | **测试与发布** | 安全测试、E2E 测试、构建发布 | TBD |

---

## 2. 详细任务分解

### Phase 1: 环境搭建与基建 (Infrastructure)
- [ ] **项目初始化**
    - 使用 `wails init` 创建项目骨架。
    - 配置前端 `vite` + `vue3` + `naive-ui` 环境。
    - 配置后端 `go mod` 依赖。
- [ ] **数据库层开发**
    - 集成 `sqlite` 和 `gorm`。
    - 设计并定义基础 Model：`Project`, `Session`, `Message`。
    - 封装通用的 `Repository` 模式或 DAO 层。
- [ ] **通用模块封装**
    - 统一的日志配置 (`slog`)。
    - 统一的错误处理与响应结构 (`Result` struct)。
    - 配置管理（加载/保存用户配置）。

### Phase 2: 核心引擎开发 (Core Engine)
- [ ] **脚本引擎集成**
    - 引入 `goja` 库。
    - 封装 `ScriptEngine` 结构体，实现脚本的加载与执行方法。
    - 定义暴露给 JS 的 Host API (如 `console.log`, `http.get`)。
- [ ] **AI 框架集成**
    - 引入 `eino` 库。
    - 实现 LLM 客户端的初始化与配置。
    - 封装 Chat 接口，支持 System Prompt 和 User Input。
- [ ] **通信层实现**
    - 实现 SSE (Server-Sent Events) Handler，用于流式推送 AI 响应。
    - Wails Bindings 定义：暴露必要的 Go 方法给前端。

### Phase 3: 业务功能开发 - 基础 (Basic Features)
- [ ] **前端基础架构**
    - 配置 `vue-router` 路由表。
    - 配置 `pinia` Store 及持久化插件。
    - 封装 `axios` 拦截器与 Wails Bridge 调用工具。
- [ ] **项目管理模块**
    - 后端：实现 `Project` 的 CRUD Service。
    - 前端：开发项目列表页、新建/编辑弹窗。
- [ ] **AI 模型管理模块**
    - 数据库：增加 `Model` 表 (字段: Name, Provider, BaseURL, APIKey, ConfigJSON)。
    - 后端：实现 Model 的 CRUD Service。
    - 后端：实现 `TestConnection` 接口，调用 eino 验证连通性。
    - 前端：开发模型配置管理页面。
- [ ] **会话管理模块**
    - 后端：实现 `Session` 和 `Message` 的存储逻辑。
    - 前端：开发会话列表侧边栏。
    - 前端：开发基础聊天界面（暂不含 AI 逻辑，仅 UI）。

### Phase 4: 业务功能开发 - 进阶 (Advanced Features)
- [ ] **脚本与工具管理**
    - 数据库：增加 `Script` 和 `Tool` 表。
    - 后端：实现脚本文件的存储与读取。
    - 前端：集成代码编辑器 (如 `monaco-editor` 或简单的 `codemirror`)。
    - 联调：前端编写脚本 -> 后端保存 -> 后端 `goja` 执行测试。
- [ ] **MCP 模块集成**
    - 实现 MCP 协议的客户端部分。
    - 允许配置 MCP Server 地址并获取资源列表。
- [ ] **Agent 管理与编排**
    - 数据库：增加 `Agent` 表。
    - 后端：实现 Agent 聚合逻辑（Prompt + Model + Tools）。
    - 核心串联：在聊天中选择 Agent -> 加载配置 -> 调用 Eino -> 执行脚本/工具 -> 返回结果。

### Phase 5: 前端 UI/UX 对接 & 完善
- [ ] **聊天体验优化**
    - 实现 Markdown 渲染组件。
    - 实现代码块高亮与复制功能。
    - 自动滚动与流式打字机效果。
- [ ] **全局 UI 美化**
    - 统一 Naive UI 主题配置。
    - 优化加载状态 (Loading) 和 错误提示 (Message/Notification)。

### Phase 6: 测试与发布 (Release)
- [ ] **测试**
    - 单元测试：重点测试 `goja` 脚本执行安全性和 `eino` 调用流程。
    - 集成测试：端到端测试完整对话流程。
- [ ] **构建**
    - 使用 `wails build` 编译 Windows/Mac/Linux 版本。
    - 编写 README 和使用文档。

## 3. 风险评估
1.  **Goja 兼容性**: JS 脚本可能需要 polyfill 才能支持现代 ES 特性，需提前调研。
2.  **Eino 学习成本**: `eino` 框架较新，需预留时间熟悉其 API 和最佳实践。
3.  **Wails 跨平台问题**: 不同 OS 下的文件路径、Webview 表现可能不一致。

## 4. 里程碑 (Milestones)
- **M1**: 能够启动应用，看到主界面，连接本地数据库。
- **M2**: 能够在界面上编写简单 JS 脚本并运行成功。
- **M3**: 能够与 AI 进行一次基础的流式对话。
- **M4**: 完成 Agent 定义，并让 Agent 成功调用一个自定义工具。
