# iat 需求分析文档

## 1. 引言

### 1.1 项目背景

`iat` 是一款基于桌面端的 AI 辅助工具，旨在提供类似 Claude Code 的交互体验。它结合了本地高效的脚本执行能力与先进的 AI 模型，通过可视化的管理界面，为开发者提供灵活的 Agent 定义、脚本执行及项目管理能力。

### 1.2 目标用户

- 需要定制化 AI 工作流的开发者。
- 需要本地化运行环境及数据隐私保护的用户。
- 习惯使用脚本扩展工具能力的极客。

## 2. 技术架构分析

本项目采用 **前后端分离** 的桌面应用架构，利用 Wails v2 桥接 Go 后端与 Web 前端。

### 2.1 技术栈概览

| 层级           | 技术/库                       | 用途         | 备注                                           |
| :------------- | :---------------------------- | :----------- | :--------------------------------------------- |
| **应用框架**   | **Wails v2**                  | 桌面应用构建 | 提供 Go 与 JS 的互操作能力，生成原生二进制文件 |
| **后端 (Go)**  | **Go 1.21+**                  | 核心业务逻辑 |                                                |
|                | `goja`                        | JS 脚本引擎  | 用于执行动态脚本，实现 Agent 的自定义逻辑      |
|                | `eino`                        | AI 框架      | 字节跳动开源框架，用于编排 LLM 调用            |
|                | `sqlite` + `gorm`             | 数据持久化   | 本地轻量级数据库，存储配置、会话及项目数据     |
|                | `mux`                         | 路由/中间件  | 处理部分 HTTP 请求（如需）                     |
|                | `slog`                        | 日志系统     | 结构化日志记录                                 |
|                | SSE (Server-Sent Events)      | 实时通信     | 实现 AI 流式回复推送到前端                     |
| **前端 (Web)** | **Vue 3**                     | UI 框架      | 使用 Composition API (`setup` 语法糖)          |
|                | `naive-ui`                    | UI 组件库    | 提供现代化的界面组件                           |
|                | `vite`                        | 构建工具     | 高效的前端构建                                 |
|                | `pinia`                       | 状态管理     | 管理全局状态 (User, Session, etc.)             |
|                | `pinia-plugin-persistedstate` | 状态持久化   | 保持用户配置不丢失                             |
|                | `axios`                       | HTTP 客户端  | 与后端 REST 接口交互                           |

### 2.2 核心机制分析

1.  **动态脚本引擎 (`goja`)**:

    - 系统需内置一个 JS 运行时环境，允许用户编写并执行 JS 脚本。
    - 脚本主要用于定义 Agent 的行为或作为 Tool 被 Agent 调用。
    - 需暴露 Go 的部分能力给 JS 环境（如文件系统访问、网络请求等，需注意权限控制）。

2.  **AI 交互 (`eino`)**:

    - 使用 `eino` 框架统一管理 LLM 的接入。
    - 支持流式输出 (Stream)，通过 SSE 将 token 实时推送到前端。

3.  **前后端通信**:
    - **命令调用**: 使用 Wails 的 Runtime 机制，前端直接调用 Go 方法（获取列表、保存配置等）。
    - **事件流**: 使用 SSE 处理 AI 的长连接响应。

## 3. 功能需求详细分析

### 3.1 核心业务模块

#### 3.1.1 Agent 管理

- **描述**: 用户可以创建个性化的 AI 智能体。
- **功能点**:
  - **CRUD**: 创建、查看、更新、删除 Agent。
  - **配置**: 设置 Agent 的名称、系统提示词 (System Prompt)、关联的模型、可使用的工具 (Tools/Scripts)。
  - **脚本关联**: Agent 可以绑定特定的动态脚本来增强能力。

#### 3.1.2 脚本 (Script) 管理

- **描述**: 提供动态扩展能力的基石。
- **功能点**:
  - **编辑**: 提供代码编辑器（前端）编写 JS 代码。
  - **执行**: 后端通过 `goja` 运行脚本。
  - **管理**: 脚本的 CRUD 操作。
  - **用途**: 作为 Agent 的 Tool 使用，或独立运行自动化任务。

#### 3.1.3 工具 (Tool) 管理

- **描述**: 管理外部工具或内部定义的函数供 Agent 调用。
- **功能点**:
  - 定义工具的输入输出 Schema (JSON Schema)。
  - 注册工具到 AI 上下文。
  - CRUD 操作。

#### 3.1.4 MCP (Model Context Protocol) 管理

- **描述**: 实现模型上下文协议，标准化 AI 与外部数据的交互。
- **功能点**:
  - MCP 服务器的配置与连接。
  - MCP 资源的浏览与管理。
  - 允许 Agent 访问 MCP 提供的上下文。

#### 3.1.5 会话 (Session) 管理

- **描述**: 所有的 AI 交互都发生在会话中。
- **功能点**:
  - **多会话支持**: 用户可以创建多个独立的聊天窗口。
  - **历史记录**: 自动保存对话历史到 SQLite。
  - **上下文控制**: 允许用户清除或编辑上下文。

#### 3.1.6 项目 (Project) 管理

- **描述**: 按照项目维度隔离环境或配置。
- **功能点**:
  - 项目的 CRUD。
  - 项目内的特定配置（如特定的环境变量、默认 Agent 等）。

#### 3.1.7 AI 模型 (Model) 管理

- **描述**: 集中管理可供 Agent 使用的 LLM 模型配置。
- **功能点**:
  - **提供商支持**: 支持标准 OpenAI 格式及其他主流提供商 (DeepSeek, Claude, Ollama 等)。
  - **参数配置**: 自定义 API Key, Base URL, Model Name, Context Window, Temperature 等。
  - **连通性测试**: 提供“测试连接”按钮，验证配置是否有效。
  - **默认设置**: 可设置全局默认模型。

### 3.2 非功能性需求

- **响应速度**: 界面操作需流畅，AI 回复延迟低。
- **数据隐私**: 所有数据（API Key、聊天记录、脚本）默认存储在本地 SQLite 数据库中。
- **扩展性**: 脚本系统设计需预留足够的 API 供未来扩展。

## 4. 界面与交互设计 (UI/UX)

- **风格**: 现代化、简洁，类似 IDE 或 聊天软件。
- **布局**:
  - 侧边栏：导航 (Agent, Script, Project, Session 等)。
  - 主区域：内容管理列表或聊天窗口。
- **交互**:
  - 列表页支持搜索与过滤。
  - 详情页支持弹窗或抽屉式编辑。
  - 聊天界面支持 Markdown 渲染与代码高亮。

## 5. 总结

`iat` 项目核心在于将 `goja` 的动态能力与 `eino` 的 AI 能力结合，通过 Wails 封装为桌面应用，为用户提供一个高度可定制的本地 AI 工作台。
